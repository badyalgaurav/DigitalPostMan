<!doctype html>
<html lang="en">

<head>
      <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="./assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="./assets/img/favicon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>Hello, world!</title>
  <!-- Required meta tags -->
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <!--     Fonts and icons     -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
  <!-- CSS Files -->
  <link href="/static/assets/css/material-kit.css?v=2.0.5" rel="stylesheet" />
  <!-- CSS Just for demo purpose, don't include it in your project -->
  <link href="/static/assets/demo/demo.css" rel="stylesheet" />
       <style>
        .input_div{

  border: 1px solid black;
  display: inline-block;
  vertical-align: top;
            overflow: auto;
            text-align: left;
            height:500px;
}
        .form__field {
  font-family: inherit;
  width: 100%;
  {#border: 0;#}
  border-bottom: 1px solid #d2d2d2;
  outline: 0;
  font-size: 16px;
  color: #212121;
  padding: 7px 0;
  background: transparent;
  transition: border-color 0.2s;
}


.form__field::placeholder {
  color: black;
}

.form__field:placeholder-shown ~ .form__label {
  font-size: 16px;
  cursor: text;
  top: 20px;
}

label,
.form__field:focus ~ .form__label {
  position: absolute;
  top: 0;
  display: block;
  transition: 0.2s;
  font-size: 12px;
  color: #9b9b9b;
}

.form__field:focus ~ .form__label {
  color: #009788;
}

.form__field:focus {
  padding-bottom: 6px;
  border-bottom: 2px solid #009788;
}
.loader{

    background: none repeat scroll 0 0 black;
position: fixed;
display:none;
opacity: 0.5;
z-index: 1000001; // or, higher
left: 0;
top: 0;
height: 100%;
width: 100%;
}
    </style>
</head>

<body>
<div  class="loader" id="loading-image">
              <div  style="width:120px;height:89px;position:absolute;top:50%;left:50%;padding:2px;"><img src='/static/assets/img/ajax-loader.gif' width="120" height="64" /><br>Loading..</div>
</div>
  <nav class="navbar navbar-color-on-scroll navbar-transparent fixed-top navbar-expand-lg" color-on-scroll="100">
    <div class="container">
      <div class="navbar-translate">
        <a class="navbar-brand" href="#">
          Digital Postman</a>

      </div>

    </div>
  </nav>
{#  <div class="page-header header-filter" data-parallax="true" style="background-image: url('/static/assets/img/bg3.jpg')">#}
{#    <div class="container">#}
{#      <div class="row">#}
{#        <div class="col-md-8 ml-auto mr-auto">#}
{#          <div class="brand text-center">#}
{#            <h1>Single Email Multiple Receiver</h1>#}
{#            <h3 class="title text-center">Send same email to many receivers at once. Insert comma(,) after every emails address.</h3>#}
{#          </div>#}
{#        </div>#}
{#      </div>#}
{#    </div>#}
{#  </div>#}
  <div class="main main-raised">
    <div class="container">
      <div class="section text-center">
        <h2 class="title">Digital Post Man</h2>
              <div id="inputs">
                  <div class="row">
                      <div class="col-md-6">  <div class="alert alert-info">
        <div class="container">
          <div class="alert-icon">
            <i class="material-icons">info_outline</i>
          </div>
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true"><i class="material-icons">clear</i></span>
          </button>
          <b>Info alert:</b> for Allowing less secure apps.
            <br>
            <a href="https://myaccount.google.com/u/1/lesssecureapps?pli=1&pageId=none" style="color:blue" target="_blank"> Link</a>
        </div>
      </div></div>
             <div class="col-md-6"> <div class="alert alert-info">
        <div class="container">
          <div class="alert-icon">
            <i class="material-icons">info_outline</i>
          </div>
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true"><i class="material-icons">clear</i></span>
          </button>
          <b>Info alert:</b> For Disabling 2-step verification
            <br>
            <a href="https://myaccount.google.com/security?utm_source=OGB&utm_medium=act#signin" style="color:blue" target="_blank">Link</a>
        </div>
      </div></div>
                          <!--        notifications -->
    <!--        end notifications -->
                  </div>
          <div class="row">
              <div class="col-lg-3 col-sm-3">
              <div class="form-group">
                <label for="exampleInput1"  class="bmd-label-floating">Your gmail Email</label>
                <input type="email" required class="form-control" id="txtEmail">
                <span class="bmd-help">We'll never share your email with anyone else.</span>
              </div>
            </div>
                     <div class="col-lg-3 col-sm-3">
              <div class="form-group">
                <label for="exampleInput1"  class="bmd-label-floating">Gmail password</label>
                <input type="password" required class="form-control" id="txtPassword">
                <span class="bmd-help">This require, so our system send mail on behalf of you.</span>
              </div>
            </div>
 <div class="col-lg-6 col-sm-6">
              <div class="form-group">
                <label for="exampleInput1"  class="bmd-label-floating">Reciever emails</label>
                <textarea required placeholder="Use comma(,) after each email address." style="text-align: left" cols="30" rows="5" id="txtReceiverEmails" >
                </textarea>
                <span class="bmd-help">Use comma(,) after each email address.</span>

              </div>
            </div>


          </div>
                       <div class="row">
                            <div class="col-lg-12 col-sm-12">
                           <div class="form-group">
                <label for="exampleInput1"  class="bmd-label-floating">Email header</label>
<input type="text" class="form-control"  id="txtEmailHeader"></input>
                           </div>
                            </div>
<br><label>Body</label>
<div class="input_div form__field " contenteditable='true' aria-placeholder="email body" id="txtEmailBody">

</div>
<label>Attachmet</label>
 <form id="upload-file" method="post" enctype="multipart/form-data" >
        <input  type = "file" id="attachment" name = "file"  onchange="fileUpload()">
      </form>
          </div>
                  <button class="btn btn-success btn-lg" id="btnSendEmail"><i class="material-icons">mail</i> Send Email</button>
        </div>

      </div>
    </div>
  </div>
  <footer class="footer footer-default">
    <div class="container">
      <nav class="float-left">
        <ul>
          <li>
            <a href="#">
              Acheron
            </a>
          </li>
        </ul>
      </nav>
      <div class="copyright float-right">
        &copy;
        <script>
          document.write(new Date().getFullYear())
        </script>
          , by
        <a href="#" target="blank">Acheron</a>.
      </div>
    </div>
  </footer>
  <!--   Core JS Files   -->
  <script src="/static/assets/js/core/jquery.min.js" type="text/javascript"></script>
  <script src="/static/assets/js/core/popper.min.js" type="text/javascript"></script>
  <script src="/static/assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
  <script src="/static/assets/js/plugins/moment.min.js"></script>
  <script src="/static/assets/js/material-kit.js?v=2.0.5" type="text/javascript"></script>
  <script>
    $(document).ready(function() {
      //init DateTimePickers
      materialKit.initFormExtendedDatetimepickers();

      // Sliders Init
      materialKit.initSliders();
    });

var resume_path="";
    function fileUpload() {
        debugger;
        var x = document.getElementById("attachment");
        var txt = "";
        if ('files' in x) {
            if (x.files.length == 0) {
                txt = "Select one or more files.";
            } else {
                for (var i = 0; i < x.files.length; i++) {
                    txt += "<br><strong>" + (i + 1) + ". file</strong><br>";
                    var file = x.files[i];
                    if ('name' in file) {
                        txt += "name: " + file.name + "<br>";
                    }
                    if ('size' in file) {
                        txt += "size: " + file.size + " bytes <br>";
                    }
                }
            }
 var form_data = new FormData($('#upload-file')[0]);
             $.ajax({
            type: 'POST',
            url: 'http://localhost:5000/uploader',
            data: form_data,
            contentType: false,
            cache: false,
            processData: false,
            success: function(data) {
                                alert("sdfdsf")

                debugger;
                resume_path=data;
                console.log('Success!');
            },
        });
        }
    }


function ValidateEmail(mail)
{
 if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail))
  {
    return (true)
  }
 else {
     alert("You have entered an invalid email address!")

     return false;
 }

}
    document.getElementById('btnSendEmail').addEventListener('click', function(){
         $("#loading-image").show();
          var login_email = $("#txtEmail").val();//document.getElementById('txtEmail').val();
         var validation=true;
validation=ValidateEmail($.trim(login_email))
  var login_pwd =$("#txtPassword").val();//document.getElementById('txtPassword').val();
        debugger;
        if (login_pwd != undefined)
        {
            validation=true;
        }
  var receiver_emails =$("#txtReceiverEmails").val(); //document.getElementById('txtReceiverEmails').val();
        var receiver_emails_list=receiver_emails.split(",");
        $.each(receiver_emails_list,function(index,data) {
         validation=ValidateEmail($.trim(data))
        });
        if (validation== true) {

            var email_header = $("#txtEmailHeader").val(); //document.getElementById('txtEmailHeader').innerHTML;

            var email_content = document.getElementById('txtEmailBody').innerHTML;

            {#document.getElementById('output').innerHTML = text;#}
            $.ajax({
                url: '/email_sender',
                data: {
                    login_email: login_email,
                    login_pwd: login_pwd,
                    receiver_emails: receiver_emails,
                    email_content: email_content,
                    email_header: email_header,
                    attachment_path:resume_path
                },
                success: function (data) {
                    $("#loading-image").hide();

                    alert("Success");
                },
                error: function (data) {
                    debugger;
                    $("#loading-image").hide();

                    alert("Please make sure, your 2 step verification disabled and you allowed to less secure apps." +
                        "Or write accurate email address and password(Note. only Gmail address)")
                }
            })
        }

});



    </script>
</body>

</html>